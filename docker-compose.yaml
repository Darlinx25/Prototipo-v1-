services:
  mosquitto:
    image: "eclipse-mosquitto:latest" #Usamos la imagen oficial de MQTT,
    ports:
      - "1883:1883" #La inicializamos y exponemos el puerto 1883
    volumes:
      - ./mosquitto/config:/mosquitto/config
      - ./mosquitto/data:/mosquitto/data
      - ./mosquitto/log:/mosquitto/log

  sensor:
    build: #Crea la imagen usando el dockerfile
      context: ./sensor 
      dockerfile: Dockerfile.sensor
    depends_on: #Se asegura de que mosquitto este listo antes de arrancar
      - mosquitto
    command: python -u sensor.py #Para ver mensajes en tiempo real
    volumes:
      - ./sensor/logs:/app/logs   # logs persistentes del sensor
      - ./sensor/data:/app/data   # si querés guardar datos generados

  consumidor:
    build:
      context: ./consumidor
      dockerfile: Dockerfile.consumidor
    depends_on:
      - mosquitto
    command: python -u consumidor.py
    volumes:
      - ./consumidor/logs:/app/logs   # logs persistentes del consumidor
      - ./consumidor/data:/app/data   # si querés guardar resultados
